from uplogic.nodes import ULActionNode
from uplogic.network.osc import OSCServer

class ULOSCSetupServer(ULActionNode):
    def __init__(self):
        ULActionNode.__init__(self)
        
        # Inputs
        self.condition_start = None
        self.condition_stop = None
        self.ip = None
        self.port = None
        self.default_address = None 
        self.debug = None  
        
        # Outputs
        self.MESSAGES = self.add_output(self._get_messages)
        
        #Internals
        self.osc_server = None
        
    def _get_messages(self):
        if self.osc_server:
            return self.osc_server.get_messages()
        else:
            return {}
    
    def evaluate(self):
        _start = self.get_input(self.condition_start)
        _stop = self.get_input(self.condition_stop)
       
        if _start and self.osc_server is None:
            # Get input
            _ip = self.get_input(self.ip)
            _port = self.get_input(self.port)
            _address = self.get_input(self.default_address)
            _debug = self.get_input(self.debug)
            
            # Start server
            self.osc_server = OSCServer(_ip, _port, _address, _debug)
            
        if _stop and self.osc_server is not None:
            # Stop server
            self.osc_server = self.osc_server._shutdown_server()
    